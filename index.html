<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Birthday Tetris Challenge</title>
<style>
  body {
    font-family: sans-serif;
    background: linear-gradient(to bottom, #ffe6f0, #fff5e6);
    color: #111;
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }
  h1 { margin-bottom: 5px; color: #d6336c; text-shadow: 2px 2px #fff; }
  #tetrisContainer {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #tetris {
    display: grid;
    grid-template-columns: repeat(10, 30px);
    grid-gap: 1px;
    background: #fff;
    border: 4px solid #d6336c;
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
  }
  .cell {
    width: 30px;
    height: 30px;
    background: #ffe6f0;
    border: 1px solid #f9c5d1;
    border-radius: 4px;
  }
  .filled { 
    background: linear-gradient(135deg, #ffb347, #ffcc33);
    border: 1px solid #ffa500;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
  }
  #score { margin-top: 10px; font-weight: bold; font-size: 18px; }
  #link { margin-top: 20px; display: none; font-size: 1.4em; color: #d6336c; font-weight: bold; text-shadow: 1px 1px #fff; }
  p { margin-top: 5px; margin-bottom: 15px; }
  .confetti {
    position: absolute;
    width: 10px; height: 10px;
    background: #ff69b4;
    opacity: 0.8;
    animation: fall 3s linear infinite;
  }
  @keyframes fall {
    0% { transform: translateY(-10px) rotate(0deg);}
    100% { transform: translateY(500px) rotate(360deg);}
  }
</style>
</head>
<body>

<h1>üéâ Happy Birthday! üéÅ</h1>
<div id="tetrisContainer">
  <p>Score 50 points to unlock your birthday surprise!</p>
  <div id="tetris"></div>
  <div id="score">Score: 0</div>
  <div id="link"><a href="https://account.vintagestory.at/createaccount?gamekeycode=1xxkyJfxYVo7i3o3xfc5hMzO2mpJMd2kDHEc0LvpmOM%3D" target="_blank">üéÅ Click Here for Your Gift! üéÅ</a></div>
</div>

<script>
// Confetti effect
for(let i=0;i<50;i++){
  const conf = document.createElement('div');
  conf.classList.add('confetti');
  conf.style.left = Math.random()*window.innerWidth+'px';
  conf.style.background = `hsl(${Math.random()*360},100%,70%)`;
  conf.style.animationDuration = (2+Math.random()*3)+'s';
  conf.style.width = conf.style.height = (5+Math.random()*5)+'px';
  document.body.appendChild(conf);
}

// Tetris logic
const rows = 20, cols = 10;
let score = 0;
const targetScore = 50;

const grid = [];
const tetrisContainer = document.getElementById("tetris");

// Create grid
for(let r=0;r<rows;r++){
  grid[r] = [];
  for(let c=0;c<cols;c++){
    grid[r][c] = 0;
    const cell = document.createElement("div");
    cell.classList.add("cell");
    cell.dataset.row = r;
    cell.dataset.col = c;
    tetrisContainer.appendChild(cell);
  }
}

// Shapes
const shapes = [
  [[1,1,1,1]],       // I
  [[1,1],[1,1]],     // O
  [[0,1,0],[1,1,1]], // T
  [[1,0,0],[1,1,1]], // L
];

let currentShape = null;
let shapeRow = 0;
let shapeCol = 3;

// Draw shape
function drawShape() {
  clearShape();
  currentShape.forEach((row,rIdx)=>{
    row.forEach((cell,cIdx)=>{
      if(cell){
        const rowPos = shapeRow + rIdx;
        const colPos = shapeCol + cIdx;
        if(rowPos >= 0 && rowPos < rows && colPos >= 0 && colPos < cols){
          grid[rowPos][colPos] = 2;
        }
      }
    });
  });
  renderGrid();
}

function clearShape(){
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      if(grid[r][c]===2) grid[r][c]=0;
    }
  }
}

function renderGrid(){
  const cells = document.querySelectorAll(".cell");
  cells.forEach(cell=>{
    const r = parseInt(cell.dataset.row);
    const c = parseInt(cell.dataset.col);
    if(grid[r][c]) cell.classList.add("filled");
    else cell.classList.remove("filled");
  });
}

function placeShape(){
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      if(grid[r][c]===2) grid[r][c]=1;
    }
  }
  checkLines();
  spawnShape();
}

function checkLines(){
  for(let r=rows-1;r>=0;r--){
    if(grid[r].every(cell=>cell===1)){
      grid.splice(r,1);
      grid.unshift(new Array(cols).fill(0));
      score += 10;
      document.getElementById("score").textContent = "Score: " + score;
      if(score >= targetScore) document.getElementById("link").style.display = "block";
    }
  }
}

function spawnShape(){
  const rand = shapes[Math.floor(Math.random()*shapes.length)];
  currentShape = rand.map(row => row.slice());
  shapeRow = 0;
  shapeCol = 3;
  if(collides()) {
    alert("Game Over!");
    location.reload();
  }
  drawShape();
}

function moveDown(){
  shapeRow++;
  if(collides()){
    shapeRow--;
    placeShape();
  } else drawShape();
}

function collides(){
  for(let r=0;r<currentShape.length;r++){
    for(let c=0;c<currentShape[r].length;c++){
      if(currentShape[r][c]){
        const rowPos = shapeRow + r;
        const colPos = shapeCol + c;
        if(rowPos >= rows || colPos<0 || colPos>=cols || grid[rowPos][colPos]===1){
          return true;
        }
      }
    }
  }
  return false;
}

function move(dir){
  shapeCol += dir;
  if(collides()) shapeCol -= dir;
  drawShape();
}

function rotateShape(shape){
  const rowsS = shape.length;
  const colsS = shape[0].length;
  const rotated = Array.from({length: colsS}, () => Array(rowsS).fill(0));
  for(let r=0;r<rowsS;r++){
    for(let c=0;c<colsS;c++){
      rotated[c][rowsS-1-r] = shape[r][c];
    }
  }
  return rotated;
}

function rotate(){
  const oldShape = currentShape;
  currentShape = rotateShape(currentShape);
  if(collides()) currentShape = oldShape;
  drawShape();
}

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft") move(-1);
  if(e.key==="ArrowRight") move(1);
  if(e.key==="ArrowDown") moveDown();
  if(e.key==="ArrowUp") rotate();
});

spawnShape();
setInterval(moveDown, 800);
</script>
</body>
</html>
